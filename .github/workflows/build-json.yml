name: Download Release Files

on:
  workflow_dispatch:
    inputs:
      repos:
        description: 'Repositories to download from (format: owner/repo, one per line)'
        required: true
        type: string

jobs:
  download-releases:
    runs-on: ubuntu-latest
    strategy:
      matrix:
        repo: ["BradyAJohnston/MolecularNodes"]
    steps:
      - uses: actions/checkout@v4
      - uses: quarto-dev/quarto-actions/setup@v2
      - uses: bradyajohnston/setup-blender@2.1
      - name: Install uv
        uses: astral-sh/setup-uv@v4
        with:
            version: "latest"
    
      - name: Get Release Assets
        run: |
          echo "" > assets.json
          gh release view --repo ${{ matrix.repo }} --json assets,name,url >> assets.json
        env:
          GH_TOKEN: ${{ github.token }}
      - name: Generate index.json
        run: |
            blender --command extension server-generate --repo-dir=repo
    
            - name: Quarto Render
            run: |
                uv run quarto render docs
    
      - name: Publish to GitHub Pages (and render)
        uses: quarto-dev/quarto-actions/publish@v2
        with:
            target: gh-pages
            path: docs
            render: false
        env:
            GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}